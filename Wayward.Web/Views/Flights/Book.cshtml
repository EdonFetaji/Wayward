@model Wayward.Domain.DTO.BookFlightDTO
@using Microsoft.AspNetCore.Mvc.Rendering

@{
	ViewData["Title"] = "Book Flight";

	var seats = Model?.AvailableSeats ?? new List<Wayward.Domain.DTO.SeatDTO>();
	var seatItems = seats
		.Select(s => new SelectListItem
				{
					Value = s.SeatNumber.ToString(),
					Text = $"Seat {s.SeatNumber}" + (s.IsWindowSeat ? " (Window)" : "")
				})
		.ToList();

	var hasSeats = seatItems.Any();
}

<div class="container py-4">
	<div class="row">
		<div class="col-lg-9 mx-auto">
			<div class="card shadow-sm mb-4">
				<div class="card-header bg-primary text-white">Flight Summary</div>
				<div class="card-body">
					<div class="row g-3">
						<div class="col-md-6">
							<div class="fw-semibold text-muted">Airline</div>
							<div class="fs-5">@Model?.SelectedFlight?.AirlineName</div>
						</div>
						<div class="col-md-6">
							<div class="fw-semibold text-muted">Date</div>
							<div class="fs-5">@Model?.SelectedFlight?.DateDeparture.ToString("yyyy-MM-dd")</div>
						</div> <div class="col-md-6">
							<div class="fw-semibold text-muted">From → To</div>
							<div class="fs-5"> @Model?.SelectedFlight?.FlightDeparture → @Model?.SelectedFlight?.FlightDestination </div>
						</div> <div class="col-md-6">
							<div class="fw-semibold text-muted">Duration</div>
							<div class="fs-5"> @Model?.SelectedFlight?.HourDuration h @Model?.SelectedFlight?.MinuteDuration m </div>
						</div>
						<div class="col-md-6">
							<div class="fw-semibold text-muted">Class</div>
							<div class="fs-5">@Model?.SelectedFlight?.Class</div>
						</div> <div class="col-md-6">
							<div class="fw-semibold text-muted">Price</div>
							<div class="fs-5">@Model?.SelectedFlight?.Price</div>
						</div>
					</div>
				</div>
			</div>

			<form asp-action="PayAndBook" method="post" class="needs-validation" novalidate>
				@Html.AntiForgeryToken()

				<div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

				<input type="hidden" asp-for="FlightId" value="@Model.FlightId" />

				@if (!hasSeats)
				{
					<div class="alert alert-warning mb-3">
						<strong>This flight has been sold out.</strong>
					</div>
				}
				@if (hasSeats)
				{
					<div class="card shadow-sm">
						<div class="card-header bg-light">Choose Your Seat</div>
						<div class="card-body">
							<div class="mb-3">
								<label class="form-label" for="SelectedSeatNumber">Seat</label>


								<select asp-for="SelectedSeatNumber"
								class="form-select"
								asp-items="seatItems"
								id="SelectedSeatNumber">
									<option value="">-- Select a seat --</option>
								</select>
								<span asp-validation-for="SelectedSeatNumber" class="text-danger"></span>


							</div>


							<div class="form-text">
								Window seats are every 3rd seat (…03, …06, …09, …).
							</div>

						</div>
					</div>
				}

				<div class="d-flex justify-content-end gap-2 mt-3">
					<a asp-action="Details"
					   asp-route-id="@Model?.SelectedFlight?.Id"
					   class="btn btn-outline-secondary">Cancel</a>

					@if (hasSeats)
					{
						<button type="submit" class="btn btn-primary">Confirm Booking and Pay</button>
					}

				</div>
			</form>

		</div>
	</div>
</div>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
}
