@model IEnumerable<Wayward.Domain.DomainModels.Flight>
@using Wayward.Domain.DomainModels

@{
    ViewData["Title"] = "My Wishlist";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1 class="h3 mb-3">My Wishlist</h1>

@if (TempData["Msg"] != null)
{
    <div class="alert alert-info">@TempData["Msg"]</div>
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <div class="text-secondary">
        <span class="badge text-dark border">Saved flights: @Model.Count()</span>
    </div>
    @if (Model.Any())
    {
        <div>
            <form asp-action="CreateCheckoutSession" method="post" class="d-inline">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-success">Pay &amp; Book All</button>
            </form>
            <div class="small text-muted mt-2">Secure payment handled by Stripe</div>

        </div>

}
</div>

@if (!Model.Any())
{
    <div class="alert alert-secondary mb-0">No flights in your wishlist yet.</div>
}
else
{
    <div class="row g-3">
        @foreach (var item in Model)
        {
            <div class="col-12">
                <div class="card shadow-sm px-4 " style="border-radius: 20px;">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <span class="badge text-bg-primary">@item.AirlineName</span>
                            <span class="badge text-warning border">@item.Class</span>
                        </div>

                        <h2 class="h5 mb-3">
                            @item.FlightDeparture
                            <span class="text-secondary">→</span>
                            @item.FlightDestination
                        </h2>

                        <div class="row gy-2">
                            <div class="col-12 col-md-3">
                                <div class="small text-secondary">Departure</div>
                                <div class="fw-semibold">@item.DateDeparture.ToString("yyyy-MM-dd")</div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="small text-secondary">Duration</div>
                                <div class="fw-semibold">@item.HourDuration h @item.MinuteDuration m</div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="small text-secondary">Seats (max)</div>
                                <div class="fw-semibold">@item.MaxSeats</div>
                            </div>
                            <div class="col-12 col-md-3">
                                <div class="small text-secondary">Price</div>
                                <div class="fw-semibold">@item.Price</div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-end mt-3">
                            <a class="btn btn-primary btn-sm" asp-controller="Flights" asp-action="Book" asp-route-id="@item.Id">
                                Book
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
